export ARM_SUBSCRIPTION_ID = 0e709027-5064-44b5-9f01-9b5d34103807
export ARM_CLIENT_ID = 04b07795-8ddb-461a-bbee-02f9e1bf7b46
export ARM_CLIENT_SECRET = yJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Im5PbzNaRHJPRFhFSzFqS1doWHNsSFJfS1hFZyIsImtpZCI6Im5PbzNaRHJPRFhFSzFqS1doWHNsSFJfS1hFZyJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuY29yZS53aW5kb3dzLm5ldC8iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8yOTQwNzRlNy00NDIwLTQzMDctOWZjYy1jNjUzMWQwZjczNjYvIiwiaWF0IjoxNjIzODE4MzIzLCJuYmYiOjE2MjM4MTgzMjMsImV4cCI6MTYyMzgyMjIyMywiYWNyIjoiMSIsImFpbyI6IkFXUUFtLzhUQUFBQS9odlZwbW9ISk5RNjEzdCtoSCtRcWJpd1pWNCtnTGxTT3ZRU0k2dHByT1F6WllnZHc4c3ZFcnVpMHYwT1JUVU5LNVBOK05TbWd5NE85VU1iVTFHR1huRjVlNDlhMkpORTBUYU9GanZyRktiajFRV2Q0SlZiMXhDemRWVlVSZHhHIiwiYWx0c2VjaWQiOiIxOmxpdmUuY29tOjAwMDNCRkZEMzZEQ0NGN0YiLCJhbXIiOlsicHdkIiwibWZhIl0sImFwcGlkIjoiMDRiMDc3OTUtOGRkYi00NjFhLWJiZWUtMDJmOWUxYmY3YjQ2IiwiYXBwaWRhY3IiOiIwIiwiZW1haWwiOiJocy4xOTkxeml0YWt1QGdtYWlsLmNvbSIsImZhbWlseV9uYW1lIjoi5qqc5qOuIiwiZ2l2ZW5fbmFtZSI6IuiEqeW5syIsImdyb3VwcyI6WyJjZWNhZjMwYy01NzJiLTQ2OTEtOWY4My04MmM4NjQ1ZjQzOGMiXSwiaWRwIjoibGl2ZS5jb20iLCJpcGFkZHIiOiI1OS4xNjguNTYuMTI0IiwibmFtZSI6IuaqnOajriDohKnlubMiLCJvaWQiOiJjM2VkODU0Yy05NTU4LTRjYjctYmUxZC03NGRlODNlNDFmYWQiLCJwdWlkIjoiMTAwMzIwMDEyMjE1NTk1RCIsInJoIjoiMC5BWEFBNTNSQUtTQkVCME9mek1aVEhROXpacFYzc0FUYmpScEd1LTRDLWVHX2UwWndBQTguIiwic2NwIjoidXNlcl9pbXBlcnNvbmF0aW9uIiwic3ViIjoiMFhScXVNSjdPMC1JeTMwNGp5bnZBeHdKOV9VcGZqNHBZRFRIYkJiMldoUSIsInRpZCI6IjI5NDA3NGU3LTQ0MjAtNDMwNy05ZmNjLWM2NTMxZDBmNzM2NiIsInVuaXF1ZV9uYW1lIjoibGl2ZS5jb20jaHMuMTk5MXppdGFrdUBnbWFpbC5jb20iLCJ1dGkiOiJocGJMUVBtMkZFQzc4anh1dG9zYUFBIiwidmVyIjoiMS4wIiwid2lkcyI6WyI2MmU5MDM5NC02OWY1LTQyMzctOTE5MC0wMTIxNzcxNDVlMTAiLCJiNzlmYmY0ZC0zZWY5LTQ2ODktODE0My03NmIxOTRlODU1MDkiXSwieG1zX3RjZHQiOjE2MTU3MDI4ODF9.UWGusUrCi92Lh6t_lSg55wrOYxgmlS_55h3KhumYzY2nkeWeBOyj5m_kO69r67b9cd-pHJbH65s_4YT1fehqNESvc0A47jFjBPbBGT_l4e_WtEE5XwujETnZ04uzL8UVSyCLnAMEEKICw8qjqoyrToX8UdvzkzTBoeV6bjZRVRFvUgVI3ZNDoVn1LU2ftbxM6DAwycnvTV6aAmnZZrPhO-o0Kx7i1zrB2SoIO1Ei_E7d6Pg3YEpuceXINZdpHhZ-2x1t27m3bXJ7u998vsLjNIqHF79rkNpLnj5HGy88_toFmQ6k5NRo2XqPEyXBoeYN1pRQZwY3Ou6N91NBiHkGnA", "refreshToken": "0.AXAA53RAKSBEB0OfzMZTHQ9zZpV3sATbjRpGu-4C-eG_e0ZwAA8.AgABAAAAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P8KkrikLUSfXCnKCWoJJkOHNjvb0_trMqtpmud9H08KiM7X5caGsqZEC3DKjzT9bgT_UTYeirxkkKEZ5UujK0Q3vgDeeUf_lOq62QPybv6mxrtVR9XOw02Yy8Jx-ZGrVWhoih-c-TCrLBwKqYfakbDrsUK9WG-6T9Ynv6RN4KL2KW1fQ53S-1iGl835_kHb9USfxz6BACRELVknwv9pRWmZHnorPeVMxtcZwsiCauzBfkUdrQhcnghek3nBo6cffi3mdXA3bosl6TJxKw4tIlyu2hoPte1TZ5jxSN3N5QcrxAUiZuXRsHJ0y8TIaPpJX4_nb2OjG3lDPUqGo9lccN99oH4TrDDn0-tCHJ5ccZ6pe00Q4Ss8AMCdUDaF9Q5ogAyNG6y93qd7OQH57OI1qJ8t2SsSRRlhfowL0-hM5rsUzy4kqZjpxdB9U31aIHKGVAmSZuy16sSrEbFGvTwSAf38Ip6cvQFMTDCeU114uFi4lIQqP6hBQnNbPaJ-ZSnryoPzOP2szC6mJ4d16uVQuH1Na3nd-jJj7OXsAMim0yz5F2eEQh5Y18f6_HgnASKPAtNf52tgFKWHhw88ZLCplBTvSY23Cj9ad2F2GNRGNWvnI7NQk1Mv7TR_DExV5UR3uVETo55l6o7FMV7vcAg2GGDaR7W37uwfUPAJo8LtEHf4g0oNH4SG_Zl65SS8rubXE4eUSMeCAICx1kDjRMc8Dg8F2Qk5TE_jxuQIeiL4Vjf089wQEh3_1app_urzIfujRNrJ37pG7eJfmNP4h7vqcKaQAwbVI2On-2xL-WXAUNydFlcBuw7iNrof2_REXM6XymeRllKtsNzA7M83lTR1rj6Pi-969GYpFg9Z5nDQc3Ejq0M58uVWncrEP738xAOVqZ_ryaTf4gJW-rL2k7hg2nuK9gsRzKtAqTxnz5_T5E0wfYQTj127zl19KheOxTTr5viU6dLrO_KqoH1CqLbzLppuIWartAAGkLvzuSwwVxsTw59Eb5Knt6PuHvShuot4hkszp3Wdyf0BtaOqELyvx5-IoX9wxSjsZkuodZYMJD1Zaj1x1mMgANgH87VUI0VUN6YxqE9RVkjDu1Esi3xasSUwQkCfY9ED4CfL2f_T1QCa6vym-RDYoVYk_6n5o8dgNVNh92v1ipmQfN4d-MdxhGfSwVvQefK1wv4gODrjTiVwiudEJcV3vjhT4snxnXMwQFWBmasLRcMFxd8PZlXXHgsXsvllX1-oOeTVzIc-RSQTMPh8_KulAiRxq3PdsTh3BPR8vx95nKRk-hDpC4QjkEClCpr-y1lVJJbJDss6OTZSFtw6IilZhgal3M8vwx6LPo-G0J8dLnH11SUqA8i_06MAxzEC-h6_q6z3iY4_RXJ-m6eABcgSR-ZeEnWbk3Xq2PQE0m_h85ayQjyZ61EBWeUPiGSE_7_NatvTV30nuFZn-_SgkVRN8LT5l2dkIz-by9fHN8eloVcjoApYyz7OsqACs9aNLX81FtbdwBTC-wfxlr7q2gtNb7uliVsf1UE48s0yd4OR6xnPMTkr6epxJ2RcYzbtNTzjiSkFXKRrsbYeWQv8amhID7Z2DkIvvgzWB2IMO5IJEnKVwUYyCLhZHjh-frp-uYnS
export ARM_TENANT_ID = 294074e7-4420-4307-9fcc-c6531d0f7366




# Configure the Microsoft Azure Provider
provider "azurerm" {
    version = "~>2.0"
    features {}
}

# Create a resource group if it doesn't exist
resource "azurerm_resource_group" "myterraformgroup" {
    name     = "myResourceGroup"
    location = "eastus"

    tags = {
        environment = "Terraform Demo"
    }
}

# Create virtual network
resource "azurerm_virtual_network" "myterraformnetwork" {
    name                = "myVnet"
    address_space       = ["10.0.0.0/16"]
    location            = "eastus"
    resource_group_name = azurerm_resource_group.myterraformgroup.name

    tags = {
        environment = "Terraform Demo"
    }
}

# Create subnet
resource "azurerm_subnet" "myterraformsubnet" {
    name                 = "mySubnet"
    resource_group_name  = azurerm_resource_group.myterraformgroup.name
    virtual_network_name = azurerm_virtual_network.myterraformnetwork.name
    address_prefixes       = ["10.0.1.0/24"]
}

# Create public IPs
resource "azurerm_public_ip" "myterraformpublicip" {
    name                         = "myPublicIP"
    location                     = "eastus"
    resource_group_name          = azurerm_resource_group.myterraformgroup.name
    allocation_method            = "Dynamic"

    tags = {
        environment = "Terraform Demo"
    }
}

# Create Network Security Group and rule
resource "azurerm_network_security_group" "myterraformnsg" {
    name                = "myNetworkSecurityGroup"
    location            = "eastus"
    resource_group_name = azurerm_resource_group.myterraformgroup.name

    security_rule {
        name                       = "SSH"
        priority                   = 1001
        direction                  = "Inbound"
        access                     = "Allow"
        protocol                   = "Tcp"
        source_port_range          = "*"
        destination_port_range     = "22"
        source_address_prefix      = "*"
        destination_address_prefix = "*"
    }

    tags = {
        environment = "Terraform Demo"
    }
}

# Create network interface
resource "azurerm_network_interface" "myterraformnic" {
    name                      = "myNIC"
    location                  = "eastus"
    resource_group_name       = azurerm_resource_group.myterraformgroup.name

    ip_configuration {
        name                          = "myNicConfiguration"
        subnet_id                     = azurerm_subnet.myterraformsubnet.id
        private_ip_address_allocation = "Dynamic"
        public_ip_address_id          = azurerm_public_ip.myterraformpublicip.id
    }

    tags = {
        environment = "Terraform Demo"
    }
}

# Connect the security group to the network interface
resource "azurerm_network_interface_security_group_association" "example" {
    network_interface_id      = azurerm_network_interface.myterraformnic.id
    network_security_group_id = azurerm_network_security_group.myterraformnsg.id
}

# Generate random text for a unique storage account name
resource "random_id" "randomId" {
    keepers = {
        # Generate a new ID only when a new resource group is defined
        resource_group = azurerm_resource_group.myterraformgroup.name
    }

    byte_length = 8
}

# Create storage account for boot diagnostics
resource "azurerm_storage_account" "mystorageaccount" {
    name                        = "diag${random_id.randomId.hex}"
    resource_group_name         = azurerm_resource_group.myterraformgroup.name
    location                    = "eastus"
    account_tier                = "Standard"
    account_replication_type    = "LRS"

    tags = {
        environment = "Terraform Demo"
    }
}

# Create (and display) an SSH key
resource "tls_private_key" "example_ssh" {
  algorithm = "RSA"
  rsa_bits = 4096
}
output "tls_private_key" { 
    value = tls_private_key.example_ssh.private_key_pem 
    sensitive = true
    }

# Create virtual machine
resource "azurerm_linux_virtual_machine" "myterraformvm" {
    name                  = "myVM"
    location              = "eastus"
    resource_group_name   = azurerm_resource_group.myterraformgroup.name
    network_interface_ids = [azurerm_network_interface.myterraformnic.id]
    size                  = "Standard_DS1_v2"

    os_disk {
        name              = "myOsDisk"
        caching           = "ReadWrite"
        storage_account_type = "Premium_LRS"
    }

    source_image_reference {
        publisher = "Canonical"
        offer     = "UbuntuServer"
        sku       = "18.04-LTS"
        version   = "latest"
    }

    computer_name  = "myvm"
    admin_username = "azureuser"
    disable_password_authentication = true

    admin_ssh_key {
        username       = "azureuser"
        public_key     = tls_private_key.example_ssh.public_key_openssh
    }

    boot_diagnostics {
        storage_account_uri = azurerm_storage_account.mystorageaccount.primary_blob_endpoint
    }

    tags = {
        environment = "Terraform Demo"
    }
}
